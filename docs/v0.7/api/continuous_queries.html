<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>InfluxDB Documentation</title><script src="//fast.fonts.net/jsapi/2de9def5-2dd1-4d89-b4bb-cd7e5f821645.js" type="text/javascript"></script><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script></head><body class="docs docs_v0"><header class="navigation"><div class="menu-wrapper"><a class="logo" href="/"><img src="/images/influxdb-light400.png" /></a><p class="navigation-menu-button" id="js-mobile-menu">MENU</p><div class="nav"><ul id="navigation-menu"><li class="nav-link"><a href="/docs/v0.7/introduction/overview.html">Overview</a></li><li class="nav-link"><a target="blank" href="https://customers.influxdb.com">Support & Hosting</a></li><li class="nav-link"><a href="/blog">Blog</a></li><li class="nav-link"><a href="/docs/v0.7/introduction/getting_started.html">Docs</a></li><li class="nav-link"><a href="/community">Community</a></li><li class="nav-link"><a target="blank" href="http://play.influxdb.org">Play</a></li></ul></div><div class="navigation-tools"><a class="sign-up" href="/download">Download</a></div></div></header><section role="main"><div class="row"><div class="large-4 medium-4 columns"><div class="sidebar"><nav><ul class="side-nav"><li class="heading">Introduction</li><li><a href="/docs/v0.7/introduction/overview.html">Overview</a></li><li><a href="/docs/v0.7/introduction/installation.html">Installation</a></li><li><a href="/docs/v0.7/introduction/getting_started.html">Getting Started</a></li><li class="divider"></li><li class="heading">API</li><li><a href="/docs/v0.7/api/reading_and_writing_data.html">Reading & Writing Data</a></li><li><a href="/docs/v0.7/api/query_language.html">Query Language</a></li><li><a href="/docs/v0.7/api/aggregate_functions.html">Aggregate Functions</a></li><li><a href="/docs/v0.7/api/continuous_queries.html">Continuous Queries</a></li><li><a href="/docs/v0.7/api/chunked_responses.html">Chunked HTTP Responses</a></li><li><a href="/docs/v0.7/api/administration.html">Administration</a></li><li class="divider"></li><li class="heading">UI</li><li><a href="/docs/v0.7/ui/built_in_admin_and_explorer.html">Built-in Admin and Explorer Interface</a></li><li><a href="/docs/v0.7/ui/grafana.html">Grafana Dashboards</a></li><li><a href="https://github.com/hakobera/influga">Influga Dashboards</a></li><li class="divider"></li><li class="heading">Advanced Topics</li><li><a href="/docs/v0.7/advanced_topics/sharding_and_storage.html">Underlying Storage and Shards</a></li><li><a href="/docs/v0.7/advanced_topics/configuration_options.html">Configuration Options</a></li><li><a href="/docs/v0.7/advanced_topics/schema_design.html">Schema Design</a></li><li><a href="/docs/v0.7/advanced_topics/performance_considerations.html">Performance Considerations</a></li><li><a href="/docs/v0.7/advanced_topics/security.html">Security</a></li><li class="divider"></li><li class="heading">Clustering</li><li><a href="/docs/v0.7/clustering/design.html">Design</a></li><li><a href="/docs/v0.7/clustering/setup.html">Setup</a></li><li class="divider"></li><li class="heading">Guides</li><li><a href="/docs/v0.7/guides/intro.html">Introduction</a></li><li><a href="/docs/v0.7/guides/replacing_graphite.html">Replacing Graphite</a></li><li class="divider"></li><li class="heading">Future Features</li><li><a href="/docs/v0.7/future/binary_protocol.html">Binary Protocol</a></li><li><a href="/docs/v0.7/future/pubsub.html">Pubsub</a></li><li><a href="/docs/v0.7/future/column_indexes.html">Column Indexes and Tags</a></li><li><a href="/docs/v0.7/future/shard_spaces.html">Shard Spaces and Retention Policies</a></li><li><a href="/docs/v0.7/future/custom_functions.html">Custom Functions</a></li><li><a href="/docs/v0.7/future/security.html">Security Enhancements</a></li><li><a href="/docs/v0.7/future/merge.html">Merging Many Series</a></li><li class="divider"></li><li class="heading">Client Libraries</li><li><a href="/docs/v0.7/client_libraries/javascript.html">JavaScript</a></li><li><a href="https://github.com/influxdb/influxdb-ruby">Ruby</a></li><li><a href="https://github.com/influxdb/influxdb-rails">Rails</a></li><li><a href="/docs/v0.7/client_libraries/python.html">Python</a></li><li><a href="https://github.com/puentesarrin/asyncflux">Python (async Tornado)</a></li><li><a href="/docs/v0.7/client_libraries/node.html">Node.js</a></li><li><a href="/docs/v0.7/client_libraries/php.html">PHP</a></li><li><a href="https://github.com/majst01/influxdb-java">Java</a></li><li><a href="https://github.com/olauzon/capacitor">Clojure</a></li><li><a href="https://github.com/mmaul/cl-influxdb">Common Lisp</a></li><li><a href="https://github.com/novaquark/metrics-influxdb">Java Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-go">Go</a></li><li><a href="https://github.com/rcrowley/go-metrics">Go Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-scala">Scala</a></li><li><a href="https://github.com/influxdb/influxdb-r">R</a></li><li><a href="https://metacpan.org/pod/InfluxDB">Perl</a></li><li><a href="https://github.com/maoe/influxdb-haskell">Haskell</a></li><li class="divider"></li><li class="heading">Contributing</li><li><a href="/community/cla.html">CLA</a></li><li><a href="https://github.com/influxdb/influxdb.org">To this Documentation</a></li><li><a href="https://github.com/influxdb/influxdb/blob/master/LICENSE">License (MIT)</a></li><li><a href="/docs/v0.7/contributing/building.html">Building From Source</a></li><li class="divider"></li><li class="heading">Other Libraries and Tools</li><li><a href="https://github.com/FGRibreau/influxdb-cli">CLI (Node)</a></li><li><a href="https://github.com/FGRibreau/influxdb-cli">CLI (Node)</a></li><li><a href="http://grafana.org/">Grafana (dashboards)</a></li><li><a href="https://github.com/obfuscurity/tasseo">Tasseo (realtime dashboard)</a></li><li><a href="https://github.com/bernd/statsd-influxdb-backend">StatsD Backend</a></li><li><a href="https://github.com/bpaquet/collectd-influxdb-proxy">CollectD Proxy</a></li><li><a href="https://github.com/fangli/fluent-plugin-influxdb">FluentD Plugin</a></li><li><a href="https://github.com/lusis/sensu_influxdb_handler">Sensu Handler</a></li><li><a href="https://github.com/SimpleFinance/chef-handler-influxdb">Chef Handler/Reporter</a></li><li><a href="https://github.com/CargoSense/puppet-influxdb">Config Management via Boxen</a></li><li class="divider"></li><li class="heading">Docs Versions</li><li><a href="/docs/v0.6/introduction/overview.html">v0.6</a></li><li><a href="/docs/v0.7/introduction/overview.html">v0.7</a></li></ul></nav><a class="button download expand" href="/download" style="margin-bottom: 0;">Download InfluxDB</a></div></div><div class="large-8 medium-8 columns" id="docs"><h1 id="continuous-queries">Continuous Queries</h1>

<p>When writing in large amounts of raw data, you will often want to query a downsampled variant of the data for viewing or analysis. In some cases, this downsampled data may be needed many times in the future, and repeatedly computing the same rollups is wasteful. Continuous queries let you precompute these expensive queries into another time series in real-time. Here are a few examples:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="n">percentile</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span> <span class="k">from</span> <span class="n">response_times</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">5</span><span class="n">m</span><span class="p">)</span> 
<span class="k">into</span> <span class="n">response_times</span><span class="p">.</span><span class="n">percentiles</span><span class="p">.</span><span class="mi">5</span><span class="n">m</span><span class="p">.</span><span class="mi">95</span>

<span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="k">from</span> <span class="n">events</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="n">m</span><span class="p">),</span> <span class="k">type</span> 
<span class="k">into</span> <span class="n">events</span><span class="p">.</span><span class="n">count_per_type</span><span class="p">.</span><span class="mi">10</span><span class="n">m</span>
</pre>

<h2 id="creating-continuous-queries">Creating Continuous Queries</h2>

<p>Continuous queries are created when you issue a select statement with an <code>into</code> clause. Instead of returning the results immediately like a normal select query, InfluxDB will instead store this continuous query and run it periodically as data is collected. Only cluster and database admins are allowed to create continuous queries. </p>

<h3 id="fanout-continuous-queries">Fanout Continuous Queries</h3>

<p>Fanout queries work as a kind of index. If you have a series where you&rsquo;re commonly querying <code>where some_col = &#39;some string&#39;</code> then you may want to use the fanout query to create series for each column values.</p>

<p>For example, the following query will fan every point from the time series <code>events</code> into a separate series per unique <code>page_id</code>:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">events</span> <span class="k">into</span> <span class="n">events</span><span class="p">.[</span><span class="n">page_id</span><span class="p">];</span>
</pre>

<p>The <code>[page_id]</code> will get interpolated with the value from the <code>page_id</code> column. Null values will result in a time series like <code>events.</code> so it&rsquo;s up to you to ensure that you actually write a <code>page_id</code> value with each event.</p>

<p>You can save some space by selecting only the columns you want included in the fanned out series:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="k">type</span> <span class="k">from</span> <span class="n">events</span> <span class="k">into</span> <span class="n">events</span><span class="p">.[</span><span class="n">page_id</span><span class="p">]</span>
</pre>

<p>This would take only the <code>type</code> column into each page specific events series. Fanout queries won&rsquo;t backfill old data. Only data written in after the creation of the fanout query will be evaluated.</p>

<h4 id="associating-fanned-out-points-with-the-original-points">Associating fanned out points with the original points</h4>

<p>When points are fanned out, the resulting points have the same <code>time</code> and <code>sequence_number</code>. That means if you know the source series, you&rsquo;ll be able to query the point that produced a fanout point by time and sequence number.</p>

<h3 id="downsampling-continuous-queries">Downsampling Continuous Queries</h3>

<p>This is expected to be the primary use case for continuous queries. When a continuous query is created from a select query that contains a group by time() clause, InfluxDB will write the aggregate into the target time series when each time interval elapses. On creation, the cluster will backfill old data asynchronously in the background.</p>
<pre class="highlight sql"><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">from</span> <span class="n">clicks</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">)</span> <span class="k">into</span> <span class="n">clicks</span><span class="p">.</span><span class="k">count</span><span class="p">.</span><span class="mi">1</span><span class="n">h</span>
</pre>

<p>Each hour, this query will count the number of points written into the time series called <code>clicks</code> and write a single point into the target time series called <code>clicks.count.1h</code>. It&rsquo;s important to note that this happens as soon as the hour has elapsed. So if you have delayed data collection, this number may be off. Watch <a href="https://github.com/influxdb/influxdb/issues/479">this issue for when that will change</a>.</p>

<h3 id="continuous-downsampling-of-many-series">Continuous Downsampling of Many Series</h3>

<p>If you have many series that you want downsampled, it&rsquo;s best to create a convention with a single continuous query that downsamples many series. Here&rsquo;s an example:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">percentile</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="n">percentile</span><span class="p">.</span><span class="mi">90</span><span class="p">,</span> <span class="n">percentile</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="n">percentile</span><span class="p">.</span><span class="mi">99</span> 
<span class="k">from</span> <span class="o">/^</span><span class="n">stats</span><span class="p">.</span><span class="o">*/</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="n">m</span><span class="p">)</span> <span class="k">into</span> <span class="mi">10</span><span class="n">m</span><span class="p">.:</span><span class="n">series_name</span>
</pre>

<p>The <code>:series_name</code> will get interpolated into the series that is selected from. Note that you should specify in the regex that the query must begin with a given name. Otherwise you can end up in a loop where new series get generated and selected from in the next run.</p>

<h2 id="listing-continuous-queries">Listing Continuous Queries</h2>

<p>To see the continuous queries you have defined, query <code>list continuous queries</code> and InfluxDB will return the id and query for each continuous query in the database.</p>

<h2 id="deleting-continuous-queries">Deleting Continuous Queries</h2>

<p>Continuous queries are referred to by their internal id, which can be retrieved through the <code>list continuous queries</code> command. The drop query takes the following form:</p>
<pre class="highlight sql"><span class="k">drop</span> <span class="n">continuous</span> <span class="n">query</span> <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span>
</pre>

<h2 id="backfilling-data">Backfilling Data</h2>

<p>In the event that the source time series already has data in it when you create a new downsampled continuous query, InfluxDB will go back in time and calculate the values for all intervals up to the present. The continuous query will then continue running in the background for all current and future intervals.</p>

<p>Fanout queries currently don&rsquo;t backfill. Watch this <a href="https://github.com/influxdb/influxdb/issues/186">issue to track fanout backfill</a>.</p>

<h2 id="recalculating-historical-intervals">Recalculating Historical Intervals</h2>

<p>Currently, the only way to recalculate historical intervals is to drop the continuous query and recreate it. However, there is an <a href="https://github.com/influxdb/influxdb/issues/211">issue open to be able to recalculate the continuous query for arbitrary ranges in the past</a>.</p>

<h2 id="restrictions-on-continuous-queries">Restrictions on Continuous Queries</h2>

<p>It&rsquo;s important to note that not all select queries can be turned into continuous queries. The limitations are specific to whether you have a group by time clause (downsampling) or no group by time clause (fanout).</p>

<p>Fanout queries don&rsquo;t work with inner joins, merges, or the where clause.</p>
</div></div></section><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45024174-1', 'influxdb.org');
ga('send', 'pageview');</script><script type="text/javascript">(function() {
  $("#docs h1, #docs h2, #docs h3, #docs h4").each(function(i, el) {
    var id, text;
    id = el.id;
    text = $(el).text();
    return $(el).html('<a href="#' + id + '">' + text + '</a>');
  });

}).call(this);
</script></body></html>