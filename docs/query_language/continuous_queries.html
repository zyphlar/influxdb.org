<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>InfluxDB Documentation</title><link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script></head><body class="docs docs_query_language docs_query_language_continuous_queries"><section class="nav"><div class="row"><nav class="top-bar hide-for-small"><ul class="title-area"><li class="name"><a href="/"><img src="/images/influxdb-light-24px.png" /></a></li></ul><li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li><section class="top-bar-section"><ul class="right"><li class="divider"></li><li><a href="/overview">Overview</a></li><li class="divider"></li><li><a href="/hosting">Support & Hosting</a></li><li class="divider"></li><li><a href="/blog">Blog</a></li><li class="divider"></li><li><a href="/docs">Docs</a></li><li class="divider"></li><li><a href="/community">Community</a></li><li class="divider"></li><li><a target="_" href="http://play.influxdb.org">Play</a></li><li class="divider"></li><li class="has-form"><a class="button" href="/download">Download</a></li></ul></section></nav></div></section><section role="main"><div class="row"><div class="large-4 medium-4 columns"><div class="sidebar"><nav><ul class="side-nav"><li class="heading">Getting Started</li><li><a href="/docs">Introduction</a></li><li class="divider"></li><li class="heading">API</li><li><a href="/docs/api/http.html">HTTP API</a></li><li><a href="/docs/api/protobuf.html">Protobuf API</a></li><li class="divider"></li><li class="heading">Query Language</li><li><a href="/docs/query_language/">Overview</a></li><li><a href="/docs/query_language/functions.html">Functions</a></li><li><a href="/docs/query_language/continuous_queries.html">Continuous Queries</a></li><li class="divider"></li><li class="heading">User Interfaces</li><li><a href="/docs/interfaces/">Overview</a></li><li><a href="/docs/interfaces/custom.html">Custom Interfaces</a></li><li><a href="http://grafana.org/">Grafana (dashboards)</a></li><li class="divider"></li><li class="heading">Libraries</li><li><a href="/docs/libraries/javascript.html">JavaScript</a></li><li><a href="/docs/libraries/ruby.html">Ruby</a></li><li><a href="https://github.com/influxdb/influxdb-rails">Rails</a></li><li><a href="/docs/libraries/python.html">Python</a></li><li><a href="/docs/libraries/node.html">Node.js</a></li><li><a href="/docs/libraries/php.html">PHP</a></li><li><a href="https://github.com/olauzon/capacitor">Clojure</a></li><li><a href="https://github.com/mmaul/cl-influxdb">Common Lisp</a></li><li><a href="https://github.com/novaquark/metrics-influxdb">Java Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-go">Go</a></li><li><a href="https://github.com/rcrowley/go-metrics">Go Metrics</a></li><li><a href="https://github.com/influxdb/influxdb-scala">Scala</a></li><li><a href="https://github.com/influxdb/influxdb-r">R</a></li><li><a href="https://metacpan.org/pod/InfluxDB">Perl</a></li><li><a href="https://github.com/maoe/influxdb-haskell">Haskell</a></li><li class="divider"></li><li class="heading">Operations</li><li><a href="/hosting">Hosting</a></li><li><a href="/docs/configuration.html">Configuration</a></li><li><a href="/docs/deployment.html">Deployment</a></li><li class="divider"></li><li class="heading">Contributing</li><li><a href="/community/cla.html">CLA</a></li><li><a href="https://github.com/influxdb/influxdb.org">Documentation</a></li><li><a href="https://github.com/influxdb/influxdb/blob/master/LICENSE">License (MIT)</a></li><li><a href="/docs/getting_started/building.html">Building From Source</a></li><li class="divider"></li><li class="heading">Other</li><li><a href="https://github.com/FGRibreau/influxdb-cli">CLI (Node)</a></li><li><a href="https://github.com/phstc/influxdb-cli">CLI (Ruby)</a></li><li><a href="/docs/visualizations.html">Visualizations & Dashboards</a></li><li><a href="https://github.com/bernd/statsd-influxdb-backend">StatsD Backend</a></li><li><a href="https://github.com/bpaquet/collectd-influxdb-proxy">CollectD Proxy</a></li><li><a href="https://github.com/fangli/fluent-plugin-influxdb">FluentD Plugin</a></li><li><a href="https://github.com/lusis/sensu_influxdb_handler">Sensu Handler</a></li><li><a href="https://github.com/SimpleFinance/chef-handler-influxdb">Chef Handler/Reporter</a></li><li><a href="https://github.com/CargoSense/puppet-influxdb">Config Management via Boxen</a></li></ul></nav><a class="button download expand" href="/download" style="margin-bottom: 0;">Download InfluxDB</a></div></div><div class="large-8 medium-8 columns"><h1>Continuous Queries</h1>

<p>When writing in large amounts of raw data, you will often want to query a downsampled variant of the data for viewing or analysis. In some cases, this downsampled data may be needed many times in the future, and repeatedly computing the same rollups is wasteful. Continuous queries let you precompute these expensive queries into another time series in real-time. Here are a few examples:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="n">percentile</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span> <span class="k">from</span> <span class="n">response_times</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">5</span><span class="n">m</span><span class="p">)</span> 
<span class="k">into</span> <span class="n">response_times</span><span class="p">.</span><span class="n">percentiles</span><span class="p">.</span><span class="mi">5</span><span class="n">m</span><span class="p">.</span><span class="mi">95</span>

<span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="k">type</span><span class="p">)</span> <span class="k">from</span> <span class="n">events</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="n">m</span><span class="p">),</span> <span class="k">type</span> 
<span class="k">into</span> <span class="n">events</span><span class="p">.</span><span class="n">count_per_type</span><span class="p">.</span><span class="mi">10</span><span class="n">m</span>
</pre>
<h2>Creating Continuous Queries</h2>

<p>Continuous queries are created when you issue a select statement with an into clause. Instead of returning the results immediately like a normal select query, InfluxDB will instead store this continuous query and run it periodically as data is collected. It&rsquo;s important to note that not all select queries can be turned into continuous queries, only those with no group by clause (fanout) or those with a time-based group by clause (downsample).</p>

<h3>Fanout Continuous Queries</h3>

<p>The following query will write every point from time series <code>clicks</code> into <code>events</code>:</p>
<pre class="highlight sql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">clicks</span> <span class="k">into</span> <span class="n">events</span><span class="p">.</span><span class="k">global</span><span class="p">;</span>
</pre>
<p>This can be valuable if you want to combine the results of multiple time series into a single time series, rather than attempting to merge data later.</p>

<h3>Downsampled Continuous Queries</h3>

<p>This is expected to be the primary use case for continunous queries. When a continuous query is created from a select query that contains a group by time() clause, InfluxDB will write the aggregate into the target time series when each time interval elapses.</p>
<pre class="highlight sql"><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">from</span> <span class="n">clicks</span> <span class="k">group</span> <span class="k">by</span> <span class="n">time</span><span class="p">(</span><span class="mi">1</span><span class="n">h</span><span class="p">)</span> <span class="k">into</span> <span class="n">clicks</span><span class="p">.</span><span class="k">count</span><span class="p">.</span><span class="mi">1</span><span class="n">h</span>
</pre>
<p>Each hour, this query will count the number of points written into the time series called <code>clicks</code> and write a single point into the target time series called <code>clicks.count.1h</code>.</p>

<h2>Listing Continuous Queries</h2>

<p>In order to see what continuous queries you have defined, just issue <code>list continuous queries</code> and InfluxDB will return the id and query for each continuous query in the queried database.</p>

<h2>Deleting Continuous Queries</h2>

<p>Continuous queries are referred to by their internal id, which can be retrieved through the <code>list continuous queries</code> command. The drop query takes the following form:</p>
<pre class="highlight sql"><span class="k">drop</span> <span class="n">continuous</span> <span class="n">query</span> <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span>
</pre>
<h2>Backfilling Data</h2>

<p>In the event that the source time series already has data in it when you create a new downsampled continuous query, InfluxDB will go back in time and calculate the values for all intervals up to the present. The continuous query will then continue running in the background for all current and future intervals.</p>
</div></div></section><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45024174-1', 'influxdb.org');
ga('send', 'pageview');</script></body></html>